<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/buyRentArticle.css" />
    <title>Buy/Rent Article Page</title>

    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAK4H-GJN8NesqK6OG9LEC5k7mZ1Y3dwZE&callback=initMap&libraries=places"></script>

    <!-- Handlebars -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.8/handlebars.min.js" 
        integrity="sha512-E1dSFxg+wsfJ4HKjutk/WaCzK7S2wv1POn1RRPGh8ZK+ag9l244Vqxji3r6wgz9YBf6+vhQEYJZpSjqWFPg9gg==" 
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>

    <header>
        <div class="header-container">
            <div class="finder-logo">
                <a href="/"><img class="logo" src="/logo3.jpg" alt="NextDoorSG logo"></a>
            </div>
            <div class="nav-link-container">
                <div class="nav-links">
                    <a href="/">Home</a>
                    <a href="/buyRentHome">Buy/rent</a>
                    <a href="/sellerHome">Sell</a>
                    <a href="/projectHome">New projects</a>
                    <a href="/tools">Tools</a>
                    <a href="#">Find agent</a>
                </div>
            </div>
            <div class="login">
                <a href="/login">Login</a>
            </div>
        </div>
    </header>

    <div class="article-container">
        <div class="article-contents">
            <div class="article-img">
                <img src="<%= article.image_path %>" alt="Property Image" />
            </div>

            <div class="article-description">
                <h1><%= article.title %></h1>
                <h3>Home Description:</h3>
                <p><%= article.description %></p>
                <h3>Home Insights:</h3>
                <p><%= article.insight %></p>
            </div>

            <div class="article-button">
                <div class="article-button-row">
                    <form action="/" method="GET">
                        <button type="submit">Shortlist</button>
                    </form>
                    <form action="/" method="GET">
                        <button type="submit">Share</button>
                    </form>
                </div>
                <div class="article-seller-info">
                    <p><strong>Seller Name:</strong> <%= article.sellerName %></p>
                    <p><%= article.sellerDetails %></p>
                </div>

                <div class="article-button-row">
                  <form action="/callDisplay/<%= article.id %>" method="GET">
                    <button type="submit">Call</button>
                  </form>
              
                  <form action="/" method="GET">
                    <button type="submit">Whatapp</button>
                  </form>
                </div>
            </div>

            <!-- Google Maps Section -->
            <div class="article-location">
                <p><strong>House Location:</strong> <%= article.location %></p>
                <h3>Interactive Map</h3>
                <div id="map" ></div>
            </div>

            <div class="article-fac">
                <h3>Home Amenities:</h3>
                <p><%= article.amenities %></p>
                <h3>Home Facilities:</h3>
                <p><%= article.facilities %></p>
            </div>
        </div>
    </div>

    <div class="recheader">
        <h3>Recommandations</h3>
    </div>

    <div class="RecommandationsArticleContainer">
        <div class="RecommandContainer" id="recarticle-container">
            <script id="recommandationsTemplate" type="text/x-handlebars-template">
                {{#each RecommandationArticles}}
                <div class="recarticle">
                    <div class="imgcontainer">
                        <a href="{{link}}"><img src="{{img}}" alt="{{altText}}" /></a>
                    </div>
                    <a href="{{link}}"><h3>{{title}}</h3></a>
                    <a href="{{link}}"><p>{{context}}</p></a>
                    <a href="{{link}}"><p>{{title}}</p></a>
                </div>
                {{/each}}
            </script>
        </div>
    </div>
    
    <br>

    <!-- Q&A section -->
    <div class="QAsectioncontainer">
      <div class="QAheader">
        <h3>FAQ</h3>
      </div>

      <div class="QA">
        <div class="QA-item">
          <div class="QA-item-header">qns 1 put here</div>
          <div class="QA-item-body">
            <div class="QA-item-body-content">ans 1 put here</div>
          </div>
        </div>

        <div class="QA-item">
          <div class="QA-item-header">qns 2 put here</div>
          <div class="QA-item-body">
            <div class="QA-item-body-content">ans 2 put here</div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="footer-container">
        <div class="footer-row">
          <h3>NextDoorSG</h3>
          <p>Follow us here:</p>
          <a href="#"><img src="https://img.icons8.com/ios/50/facebook--v1.png" alt="Facebook logo" ></a>
          <a href="#"><img src="https://img.icons8.com/ios/50/twitterx--v1.png" alt="X logo" ></i></a>
          <a href="#"><img src="https://img.icons8.com/ios/50/instagram-new--v1.png" alt="Insta logo" ></i></a>
          <a href="#"><img src="https://img.icons8.com/ios/50/youtube-play--v1.png" alt="Youtube logo" ></i></a>
        </div>
       
        <div class="footer-col">
          <ul>
            <li><a href="/projectHome">New Projects</a></li>
            <li><a href="/tools">Tools</a></li>
            <li><a href="#">Find Agents</a></li>
          </ul>
        </div>

        <div class="footer-col">
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Term of Service</a></li>
          </ul>
        </div>

        <div class="footer-col">
          <ul>
            <li><a href="#">Sitemap</a></li>
            <li><a href="#">Licenses</a></li>
            <li><a href="#">Mobile App</a></li>
            <li><a href="#">Term of Service</a></li>
          </ul>
        </div>
 
        <div class="footer-bottom">
          <p><small>&copy;NextDoorSG. All rights reserved. Images are for illustrative purposes</small></p>
          <p><small>Terms and conditions apply</small></p>
        </div>
      </div>
    </footer>

    <script>
      // handle bar for Recommandations
      document.addEventListener("DOMContentLoaded", function () {
        var recArr = {
          RecommandationArticles: [
            {
              link: "#",
              altText: "venus-flytrap",
              img: "./image/venus-flytrap.jpg",
              title: "Venus Flytrap: Natures Carnivorous Marvel",
              context:
                "Uncover the secrets of the Venus Flytrap, a botanical predator.",
              name: "Admin",
              date: "14/Sep/2025",
            },
            {
              link: "#",
              altText: "polar bear",
              img: "./image/polar-bear.jpg",
              title: "The Enigmatic World of Polar Bears",
              context:
                "Explore the resilient life of polar bears in the Arctic wilderness.",
              name: "Admin",
              date: "09/Nov/2025",
            },
            {
              link: "#",
              altText: "pelican",
              img: "./image/pelican.jpg",
              title: "Majestic Pelicans: Masters of Aerial Grace",
              context:
                "Explore the elegance and ecological significance of pelicans in their natural habitat.",
              name: "Admin",
              date: "14/Jun/2025",
            }

          ],
        };

        // Get the Handlebars template
        var recommandSource = document.getElementById("recommandationsTemplate").innerHTML;
        var recommandTemplate = Handlebars.compile(recommandSource);

        // Render the template with data
        var recommandArticles = recommandTemplate(recArr);

        // Append the rendered object to container
        document.querySelector("#recarticle-container").innerHTML =
        recommandArticles;
      });

      // Q&A js script //
      const QAItemHeaders = document.querySelectorAll(".QA-item-header");
      QAItemHeaders.forEach((QAItemHeader) => {
        QAItemHeader.addEventListener("click", (event) => {
          const currentActiveQAItemHeader = document.querySelector(
            ".QA-item-header.active"
          );
          if (
            currentActiveQAItemHeader &&
            currentActiveQAItemHeader !== QAItemHeader
          ) {
            currentActiveQAItemHeader.classList.toggle("active");
            currentActiveQAItemHeader.nextElementSibling.style.maxHeight = 0;
          }

          QAItemHeader.classList.toggle("active");
          const QAItemBody = QAItemHeader.nextElementSibling;
          if (QAItemHeader.classList.contains("active")) {
            QAItemBody.style.maxHeight = QAItemBody.scrollHeight + "px";
          } else {
            QAItemBody.style.maxHeight = 0;
          }
        });
      });
    </script>

<script>
  function initMap() {
      var location = "<%= article.location %>"; // Get user-inputted address
      console.log("Location from article.location:", location); // DEBUGGING LOG

      var geocoder = new google.maps.Geocoder();
      var mapOptions = {
          zoom: 15,
          center: { lat: 1.3521, lng: 103.8198 } // Default to Singapore
      };
      var map = new google.maps.Map(document.getElementById("map"), mapOptions);

      // Convert address into lat/lng using Geocoding API
      geocoder.geocode({ address: location }, function(results, status) {
          if (status === "OK") {
              var propertyLocation = results[0].geometry.location;
              map.setCenter(propertyLocation);

              new google.maps.Marker({
                  map: map,
                  position: propertyLocation,
                  title: "Property Location"
              });
              console.log("Geocoded location:", propertyLocation); // DEBUGGING LOG
          } else {
              console.error("Geocode failed:", status);
              alert("Could not find location: " + location);
          }
      });
  }

  // Ensure initMap is globally available for Google API callback
  window.initMap = initMap;
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAK4H-GJN8NesqK6OG9LEC5k7mZ1Y3dwZE&callback=initMap&libraries=places"></script>


  </body>
</html>
